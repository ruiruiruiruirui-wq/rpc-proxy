    location /birdeye/ {
        access_log /etc/nginx/logs/birdeye-access.log rpc-proxy;
        error_log /etc/nginx/logs/birdeye-error.log error;

        content_by_lua_block {
            local http = require "resty.http"
            local cjson = require "cjson"
            
            -- 从环境变量获取 API key
            local api_key = os.getenv("BIRDEYE_API_KEY")
            if not api_key then
                ngx.log(ngx.ERR, "BIRDEYE_API_KEY environment variable not set")
                ngx.status = 500
                ngx.say('{"error": "API key not configured"}')
                return
            end
            
            local uri = ngx.var.uri
            local args = ngx.var.args
            local path = string.gsub(uri, "^/birdeye/", "/")
            local upstream_url = "https://public-api.birdeye.so" .. path
            if args then
                upstream_url = upstream_url .. "?" .. args
            end
            
            local httpc = http.new()
            httpc:set_timeout(30000)
            
            local headers = {}
            local req_headers = ngx.req.get_headers()
            for k, v in pairs(req_headers) do
                if k ~= "host" and k ~= "connection" and k ~= "authorization" then
                    headers[k] = v
                end
            end
            headers["Host"] = "public-api.birdeye.so"
            headers["X-API-KEY"] =  api_key
            headers["accept-encoding"] = "identity"
            
            ngx.req.read_body()
            local body = ngx.req.get_body_data()
            
            local res, err = httpc:request_uri(upstream_url, {
                method = ngx.var.request_method,
                body = body,
                headers = headers,
                ssl_verify = false,
                keepalive_timeout = 60000,
                keepalive_pool = 10
            })
            
            if not res then
                ngx.log(ngx.ERR, "failed to request upstream: ", err)
                ngx.status = 502
                ngx.say('{"error": "upstream request failed"}')
                return
            end
            
            ngx.status = res.status
            for k, v in pairs(res.headers) do
                if k ~= "connection" and k ~= "transfer-encoding" then
                    ngx.header[k] = v
                end
            end
            
            ngx.say(res.body)
        }
    }
